<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EnqueueZero Techshack 2019-03 | Enqueue Zero</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Enqueue Zero is publishing code principles.">
    
    <link rel="preload" href="/assets/css/0.styles.472f46d1.css" as="style"><link rel="preload" href="/assets/js/app.26662bcd.js" as="script"><link rel="preload" href="/assets/js/6.d2240214.js" as="script"><link rel="preload" href="/assets/js/147.aa478e29.js" as="script"><link rel="preload" href="/assets/js/3.dd706b41.js" as="script"><link rel="preload" href="/assets/js/4.29da6077.js" as="script"><link rel="prefetch" href="/assets/js/1.f7157d85.js"><link rel="prefetch" href="/assets/js/10.bb89159d.js"><link rel="prefetch" href="/assets/js/100.696fc0f0.js"><link rel="prefetch" href="/assets/js/101.a1c3f849.js"><link rel="prefetch" href="/assets/js/102.bfa743be.js"><link rel="prefetch" href="/assets/js/103.694af51d.js"><link rel="prefetch" href="/assets/js/104.c21c3757.js"><link rel="prefetch" href="/assets/js/105.d5841585.js"><link rel="prefetch" href="/assets/js/106.9cf7fa00.js"><link rel="prefetch" href="/assets/js/107.1ec93d70.js"><link rel="prefetch" href="/assets/js/108.0b8763b2.js"><link rel="prefetch" href="/assets/js/109.e7196d2e.js"><link rel="prefetch" href="/assets/js/11.e30c030f.js"><link rel="prefetch" href="/assets/js/110.a6dd1b2d.js"><link rel="prefetch" href="/assets/js/111.77cce519.js"><link rel="prefetch" href="/assets/js/112.70165eb2.js"><link rel="prefetch" href="/assets/js/113.3fa50ee2.js"><link rel="prefetch" href="/assets/js/114.31c8c10f.js"><link rel="prefetch" href="/assets/js/115.af04f95c.js"><link rel="prefetch" href="/assets/js/116.457c2566.js"><link rel="prefetch" href="/assets/js/117.c43e188a.js"><link rel="prefetch" href="/assets/js/118.8cf2c53e.js"><link rel="prefetch" href="/assets/js/119.bd688ff9.js"><link rel="prefetch" href="/assets/js/12.3e81efff.js"><link rel="prefetch" href="/assets/js/120.dc1164f5.js"><link rel="prefetch" href="/assets/js/121.f8bd20ba.js"><link rel="prefetch" href="/assets/js/122.58c1b292.js"><link rel="prefetch" href="/assets/js/123.3ab17f6c.js"><link rel="prefetch" href="/assets/js/124.79a8fefc.js"><link rel="prefetch" href="/assets/js/125.bb87430b.js"><link rel="prefetch" href="/assets/js/126.de1343ef.js"><link rel="prefetch" href="/assets/js/127.d66cf797.js"><link rel="prefetch" href="/assets/js/128.c2ce57e8.js"><link rel="prefetch" href="/assets/js/129.e0515a98.js"><link rel="prefetch" href="/assets/js/13.3ae4e3c9.js"><link rel="prefetch" href="/assets/js/130.b198674a.js"><link rel="prefetch" href="/assets/js/131.b44003aa.js"><link rel="prefetch" href="/assets/js/132.9ce0efcd.js"><link rel="prefetch" href="/assets/js/133.c5ff5656.js"><link rel="prefetch" href="/assets/js/134.27dfad96.js"><link rel="prefetch" href="/assets/js/135.1a6c5976.js"><link rel="prefetch" href="/assets/js/136.a40474aa.js"><link rel="prefetch" href="/assets/js/137.337a587b.js"><link rel="prefetch" href="/assets/js/138.c0a1d2f5.js"><link rel="prefetch" href="/assets/js/139.789324e5.js"><link rel="prefetch" href="/assets/js/14.6745f1f0.js"><link rel="prefetch" href="/assets/js/140.0f6046b7.js"><link rel="prefetch" href="/assets/js/141.ca8677a9.js"><link rel="prefetch" href="/assets/js/142.7cd41612.js"><link rel="prefetch" href="/assets/js/143.4e06cdc6.js"><link rel="prefetch" href="/assets/js/144.30a011d9.js"><link rel="prefetch" href="/assets/js/145.616e4d0c.js"><link rel="prefetch" href="/assets/js/146.9f8b8212.js"><link rel="prefetch" href="/assets/js/148.3114d5cd.js"><link rel="prefetch" href="/assets/js/149.f8711773.js"><link rel="prefetch" href="/assets/js/15.2f559067.js"><link rel="prefetch" href="/assets/js/150.66da4609.js"><link rel="prefetch" href="/assets/js/151.9a722cf9.js"><link rel="prefetch" href="/assets/js/152.c625b811.js"><link rel="prefetch" href="/assets/js/153.6f67989f.js"><link rel="prefetch" href="/assets/js/154.8d3771fd.js"><link rel="prefetch" href="/assets/js/155.db2eb76a.js"><link rel="prefetch" href="/assets/js/156.d5dd02f5.js"><link rel="prefetch" href="/assets/js/157.12f4dc82.js"><link rel="prefetch" href="/assets/js/158.106505d8.js"><link rel="prefetch" href="/assets/js/159.a2dbf072.js"><link rel="prefetch" href="/assets/js/16.b9adde67.js"><link rel="prefetch" href="/assets/js/160.3145ef30.js"><link rel="prefetch" href="/assets/js/161.25da45f5.js"><link rel="prefetch" href="/assets/js/162.a65448a4.js"><link rel="prefetch" href="/assets/js/163.f07fa25d.js"><link rel="prefetch" href="/assets/js/164.467c6d5c.js"><link rel="prefetch" href="/assets/js/17.01834c30.js"><link rel="prefetch" href="/assets/js/18.9956aed9.js"><link rel="prefetch" href="/assets/js/19.d99e88b1.js"><link rel="prefetch" href="/assets/js/2.0d8a973f.js"><link rel="prefetch" href="/assets/js/20.8ce58444.js"><link rel="prefetch" href="/assets/js/21.8e95e990.js"><link rel="prefetch" href="/assets/js/22.46dc304c.js"><link rel="prefetch" href="/assets/js/23.1ad9ea02.js"><link rel="prefetch" href="/assets/js/24.32437043.js"><link rel="prefetch" href="/assets/js/25.e3764fbe.js"><link rel="prefetch" href="/assets/js/26.e4eec541.js"><link rel="prefetch" href="/assets/js/27.54c6db2e.js"><link rel="prefetch" href="/assets/js/28.8dc6cb87.js"><link rel="prefetch" href="/assets/js/29.4d3624fc.js"><link rel="prefetch" href="/assets/js/30.c4d8ab26.js"><link rel="prefetch" href="/assets/js/31.d28673cb.js"><link rel="prefetch" href="/assets/js/32.51d979f3.js"><link rel="prefetch" href="/assets/js/33.7359ba2a.js"><link rel="prefetch" href="/assets/js/34.c3f19c8f.js"><link rel="prefetch" href="/assets/js/35.1613123f.js"><link rel="prefetch" href="/assets/js/36.5a82821a.js"><link rel="prefetch" href="/assets/js/37.b95059f5.js"><link rel="prefetch" href="/assets/js/38.67082dba.js"><link rel="prefetch" href="/assets/js/39.f9e197d7.js"><link rel="prefetch" href="/assets/js/40.309fa7cc.js"><link rel="prefetch" href="/assets/js/41.12e2904c.js"><link rel="prefetch" href="/assets/js/42.60c54b7c.js"><link rel="prefetch" href="/assets/js/43.93d5d55c.js"><link rel="prefetch" href="/assets/js/44.c7972aa3.js"><link rel="prefetch" href="/assets/js/45.0e7f822e.js"><link rel="prefetch" href="/assets/js/46.6646cc92.js"><link rel="prefetch" href="/assets/js/47.ef2ff153.js"><link rel="prefetch" href="/assets/js/48.aba7bfcd.js"><link rel="prefetch" href="/assets/js/49.76ce0dd5.js"><link rel="prefetch" href="/assets/js/50.bfd5ce8a.js"><link rel="prefetch" href="/assets/js/51.78e9f09c.js"><link rel="prefetch" href="/assets/js/52.d84bf105.js"><link rel="prefetch" href="/assets/js/53.63ae3ba7.js"><link rel="prefetch" href="/assets/js/54.c13091c1.js"><link rel="prefetch" href="/assets/js/55.0fd04d7d.js"><link rel="prefetch" href="/assets/js/56.30c3e036.js"><link rel="prefetch" href="/assets/js/57.88f684ac.js"><link rel="prefetch" href="/assets/js/58.b0273999.js"><link rel="prefetch" href="/assets/js/59.2bd4017a.js"><link rel="prefetch" href="/assets/js/60.cb5e31cd.js"><link rel="prefetch" href="/assets/js/61.78c24020.js"><link rel="prefetch" href="/assets/js/62.ed7bb122.js"><link rel="prefetch" href="/assets/js/63.6dc67c03.js"><link rel="prefetch" href="/assets/js/64.ba48b753.js"><link rel="prefetch" href="/assets/js/65.95fb6a85.js"><link rel="prefetch" href="/assets/js/66.cf7b0f4b.js"><link rel="prefetch" href="/assets/js/67.135e02b9.js"><link rel="prefetch" href="/assets/js/68.692785cb.js"><link rel="prefetch" href="/assets/js/69.71acc6d9.js"><link rel="prefetch" href="/assets/js/7.e6dfaa84.js"><link rel="prefetch" href="/assets/js/70.9330fa95.js"><link rel="prefetch" href="/assets/js/71.323daa7b.js"><link rel="prefetch" href="/assets/js/72.0a1f652c.js"><link rel="prefetch" href="/assets/js/73.58f8d79d.js"><link rel="prefetch" href="/assets/js/74.c79161f6.js"><link rel="prefetch" href="/assets/js/75.ebdc4060.js"><link rel="prefetch" href="/assets/js/76.d7c6a683.js"><link rel="prefetch" href="/assets/js/77.1c74ae52.js"><link rel="prefetch" href="/assets/js/78.1435c08f.js"><link rel="prefetch" href="/assets/js/79.550e023e.js"><link rel="prefetch" href="/assets/js/8.9d730b63.js"><link rel="prefetch" href="/assets/js/80.0fcde753.js"><link rel="prefetch" href="/assets/js/81.54ad9ad6.js"><link rel="prefetch" href="/assets/js/82.106f6213.js"><link rel="prefetch" href="/assets/js/83.eb1f77af.js"><link rel="prefetch" href="/assets/js/84.dc27d377.js"><link rel="prefetch" href="/assets/js/85.952de193.js"><link rel="prefetch" href="/assets/js/86.849ef641.js"><link rel="prefetch" href="/assets/js/87.ba839e63.js"><link rel="prefetch" href="/assets/js/88.55c67120.js"><link rel="prefetch" href="/assets/js/89.2b92f963.js"><link rel="prefetch" href="/assets/js/9.4f13d7d8.js"><link rel="prefetch" href="/assets/js/90.599d1ee9.js"><link rel="prefetch" href="/assets/js/91.ca49947d.js"><link rel="prefetch" href="/assets/js/92.fee804a1.js"><link rel="prefetch" href="/assets/js/93.38edda54.js"><link rel="prefetch" href="/assets/js/94.2a5af489.js"><link rel="prefetch" href="/assets/js/95.694d7882.js"><link rel="prefetch" href="/assets/js/96.dbae4a47.js"><link rel="prefetch" href="/assets/js/97.f635273c.js"><link rel="prefetch" href="/assets/js/98.4b13da17.js"><link rel="prefetch" href="/assets/js/99.1c228ad5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.472f46d1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Enqueue Zero</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/soasme/enqueuezero" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/soasme/enqueuezero" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>EnqueueZero Techshack 2019-03</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/techshack.weekly/2019-03.html#gcp-incident-19001" class="sidebar-link">GCP Incident 19001</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#interpreting-kafka-s-exactly-once-semantics" class="sidebar-link">Interpreting Kafka's Exactly-Once Semantics</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#towards-successful-resilient-software-design" class="sidebar-link">Towards Successful Resilient Software Design</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#designing-resilient-systems-circuit-breakers-or-retries" class="sidebar-link">Designing resilient systems: Circuit Breakers or Retries?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#production-guideline" class="sidebar-link">Production Guideline</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#composing-programs" class="sidebar-link">Composing Programs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#why-is-storage-on-kubernetes-so-hard" class="sidebar-link">Why Is Storage On Kubernetes So Hard?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#open-sourcing-our-kubernetes-tools" class="sidebar-link">Open Sourcing our Kubernetes Tools</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#kubernetes-security-best-practices" class="sidebar-link">Kubernetes Security Best Practices</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#automating-datacenter-operations-at-dropbox" class="sidebar-link">Automating Datacenter Operations at Dropbox</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/techshack.weekly/2019-03.html#on-infrastructure-at-scale-a-cascading-failure-of-distributed-systems" class="sidebar-link">On Infrastructure at Scale: A Cascading Failure of Distributed Systems</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="enqueuezero-techshack-2019-03"><a href="#enqueuezero-techshack-2019-03" class="header-anchor">#</a> EnqueueZero Techshack 2019-03</h1> <div class="techshack-header"><p>Kia ora! I am the creator of <strong>Enqueue Zero</strong> (<a href="https://enqueuezero.com">https://enqueuezero.com</a>), a site that explains code principles to Developers/DevOps/Sysadmins. This site is updated under a single man team since 2018. The `EnqueueZero Techshack` series is comprised of a bunch of interesting posts I wrote or found on the Internet. More importantly, I hope these posts would please you.</p><p></p><div><p>
      Please follow Twitter account <a href="https://twitter.com/enqueuezero">@enqueuezero</a> for the updates.  Happy exploring!
    </p></div></div> <h2 id="gcp-incident-19001"><a href="#gcp-incident-19001" class="header-anchor">#</a> GCP Incident 19001</h2> <p><a href="https://status.cloud.google.com/incident/appengine/19001" target="_blank" rel="noopener noreferrer">status.cloud.google.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>To sum up, the issue was the application couldn't be created. The root cause was due to a different configuration in the testing environment and the production environment. It eventually leads to all data written into the metadata store failed.</p> <p>The solution is to implement additional validation to the metadata storeâ€™s schemas and ensure that test validation of metadata store configuration matches production. Though canary deployment was not mentioned.</p> <h2 id="interpreting-kafka-s-exactly-once-semantics"><a href="#interpreting-kafka-s-exactly-once-semantics" class="header-anchor">#</a> Interpreting Kafka's Exactly-Once Semantics</h2> <p><a href="https://dzone.com/articles/interpreting-kafkas-exactly-once-semantics" target="_blank" rel="noopener noreferrer">dzone.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This post introduces the exactly-once delivery semantic in Kafka.</p> <p>There are three delivery guarantees:</p> <ol><li>At most once delivery.</li> <li>At least once delivery.</li> <li>Exactly once delivery. In particular, it is the most important and difficult.</li></ol> <p>Problem 1, the message is being processed and sent to the message queue but never got the acknowledgment. And we don't want to send it multiple times.
Problem 2, the message is being processed and then the application crashed. Now once we bring back the application, it re-reads the message and hence the message is double processed.</p> <p>To avoid the two problems, Kafka's solution is by using below techniques.</p> <ul><li>Idempotent producer. Practically, each message has <code>idempotence=true</code> and a unique transaction id.</li> <li>Transactions across partitions. The read-write can be put into a transaction, so it's all-or-nothing.</li> <li>Set transaction isolation level <code>read_commited</code>.</li></ul> <h2 id="towards-successful-resilient-software-design"><a href="#towards-successful-resilient-software-design" class="header-anchor">#</a> Towards Successful Resilient Software Design</h2> <p><a href="https://www.infoq.com/articles/towards-resilient-software-design" target="_blank" rel="noopener noreferrer">infoq.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Today's distributed system needs to be resilient. Resilient, in short, is a way that ideally a user does not notice at all if an unexpected failure occurs or that the user at least can continue to use the degraded application.</p> <p>The challenges of resilient software design include:</p> <ul><li>Understanding the business case.</li> <li>Understanding the distributed system is non-deterministic.</li> <li>Impossible to reach 100% available. Even if you try to make it, it costs you.</li> <li>Establishing the Ops-Dev feedback loop.</li> <li>Getting the service dependency and functional design right.</li> <li>Understanding patterns.</li> <li>Keeping up the new technology.</li></ul> <h2 id="designing-resilient-systems-circuit-breakers-or-retries"><a href="#designing-resilient-systems-circuit-breakers-or-retries" class="header-anchor">#</a> Designing resilient systems: Circuit Breakers or Retries?</h2> <p><a href="https://engineering.grab.com/designing-resilient-systems-part-1" target="_blank" rel="noopener noreferrer">part 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> | <a href="https://engineering.grab.com/designing-resilient-systems-part-2" target="_blank" rel="noopener noreferrer">part 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The two posts include circuit breaker, retry, jitter, back-off, etc.</p> <p>Short conclusions:</p> <ul><li>Per-host circuit breaker will hide problem when one of the instances of service is having a problem.</li> <li>Only using retry will cause a cascading failure.</li> <li>Circuit Breaker (per service) is better than Retry, and the Retry is better than Circuit Breaker (per host).</li> <li>Use circuit breaker with retry together. If we were to retry the 10% of requests that failed once, 90% of those requests would pass on the second attempt. Our success rate would then go from the original 90% to 90% + ( 90% x 10%) = 99%</li></ul> <h2 id="production-guideline"><a href="#production-guideline" class="header-anchor">#</a> Production Guideline</h2> <p><a href="https://medium.com/@rakyll/production-guideline-9d5d10c8f1e" target="_blank" rel="noopener noreferrer">medium.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This post includes a bunch of useful tips for production services.</p> <ul><li>Builds should not depend on the external system.</li> <li>Document SLOs at the design stage. Document how releases affect SLOs.</li> <li>Document the availability expect of external services.</li> <li>Avoid SPOF by either replicating resources of using the hardcoded fallback.</li> <li>Non-secret config can be command-line flags.</li> <li>Be able to fallback if the system depends on a configuration system.</li> <li>Don't inherit dev config from prod config.</li> <li>Document the entire release process, including canary release.</li> <li>Automatically revert canaries if possible.</li> <li>Ensure rollbacks can use the same process that rollouts use.</li> <li>Collect metrics.</li> <li>Differentiate client-side and server-side data.</li> <li>Tune alerts to reduce toil.</li> <li>Propagate the trace context.</li> <li>Encrypt all requests.</li> <li>Use VPN, IAM, ACL, audit, ...</li> <li>Sanitize user input.</li> <li>Avoid external endpoints that trigger a large number of internal fan-outs.</li> <li>Document how the service scales, how many resources it needs, the quota and resource constraints.</li> <li>Load test.</li></ul> <h2 id="composing-programs"><a href="#composing-programs" class="header-anchor">#</a> Composing Programs</h2> <p><a href="https://composingprograms.com/" target="_blank" rel="noopener noreferrer">composingprograms.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This is a free online introduction to programming and computer science. It's based on book SICP and refurbished with Python 3.</p> <ul><li>Elements of Programming: expressions, combinations, and abstraction!</li> <li>The techniques of building abstractions with functions are calling functions, composing higher-order functions, and recursive functions.</li> <li>The techniques of building abstractions with data are using the list, OO models, stream, etc.</li> <li>When we say programming, we actually write yet another language. The third chapter explains how to implement an interpreter language.</li> <li>Programming paradigms:
<ul><li>Implicit sequences. It's using a stream data structure in the basic.</li> <li>Logic Programming. It's using fact and logical queries as the building block.</li> <li>Distributed Computing. The message becomes the fundamental element between peers in a Client-Server architecture.</li> <li>Distributed Data Processing. It means a map-reduce pattern, dividing and then conquering.</li> <li>Parallel Computing. It's about threading, multiprocessing, locking share states.</li></ul></li></ul> <h2 id="why-is-storage-on-kubernetes-so-hard"><a href="#why-is-storage-on-kubernetes-so-hard" class="header-anchor">#</a> Why Is Storage On Kubernetes So Hard?</h2> <p><a href="https://softwareengineeringdaily.com/2019/01/11/why-is-storage-on-kubernetes-is-so-hard/" target="_blank" rel="noopener noreferrer">softwareengineeringdaily.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Kubernetes is good because it provides a dynamic architecture for managing containers.
However, a persistent storage solution cannot afford this dynamic behavior.
We cannot dynamically create and destroy persistent storage, because the DATA is in it.</p> <p>In production developers usually, rely on external storage. And Kubernetes offers Volume Plugins.
Previously, volume plugins are handcrafted into Kubernetes core codebase, which was inflexible.
With the introduction of CSI and Flexvolume, volume plugins can be deployed on a cluster without the changes to the codebase.</p> <p>Now we can use PV, PVC, StatefulSet, and StorageClass managing volumes provided by external vendors.
If you prefer a cloud-native OSS solution, try Ceph and Rook.</p> <h2 id="open-sourcing-our-kubernetes-tools"><a href="#open-sourcing-our-kubernetes-tools" class="header-anchor">#</a> Open Sourcing our Kubernetes Tools</h2> <p><a href="https://engineering.tumblr.com/post/182013497734/open-sourcing-our-kubernetes-tools" target="_blank" rel="noopener noreferrer">engineering.tumblr.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Tumblr engineering team open sourced several of their Kubernetes tools.</p> <ul><li><a href="https://github.com/tumblr/k8s-sidecar-injector" target="_blank" rel="noopener noreferrer">k8s-sidecar-injector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It helps to inject a logger container into your pod by defining a ConfigMap.</li> <li><a href="https://github.com/tumblr/k8s-config-projector" target="_blank" rel="noopener noreferrer">k8s-config-injector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It's meant to be run by CI. It pulls code and data in the configuration repo and populates into ConfigMap.</li> <li><a href="https://github.com/tumblr/k8s-secret-projector" target="_blank" rel="noopener noreferrer">k8s-secret-injector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, Similarly, this tool inject credential information into Secret.</li></ul> <h2 id="kubernetes-security-best-practices"><a href="#kubernetes-security-best-practices" class="header-anchor">#</a> Kubernetes Security Best Practices</h2> <p><a href="https://www.cncf.io/blog/2019/01/14/9-kubernetes-security-best-practices-everyone-must-follow/" target="_blank" rel="noopener noreferrer">cncf.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>Upgrade to the Latest Version</li> <li>Enable Role-Based Access Control (RBAC)</li> <li>Use Namespaces to Establish Security Boundaries</li> <li>Separate Sensitive Workloads</li> <li>Secure Cloud Metadata Access</li> <li>Create and Define Cluster Network Policies</li> <li>Run a Cluster-wide Pod Security Policy</li> <li>Harden Node Security
<ul><li>Ensure the host is secure and configured correctly.</li> <li>Control network access to sensitive ports.</li> <li>Minimize administrative access to Kubernetes nodes.</li></ul></li> <li>Turn on Audit Logging</li></ul> <h2 id="automating-datacenter-operations-at-dropbox"><a href="#automating-datacenter-operations-at-dropbox" class="header-anchor">#</a> Automating Datacenter Operations at Dropbox</h2> <p><a href="https://blogs.dropbox.com/tech/2019/01/automating-datacenter-operations-at-dropbox/" target="_blank" rel="noopener noreferrer">blogs.dropbox.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Dropbox engineers invented Pirlo system to automate their work in Data Center Operations.</p> <p>At a high level, Pirlo consists of a distributed MySQL-backed job queue built in-house using many of the primitives available in Dropbox production such as gRPC, service discovery, and our managed MySQL clusters.</p> <div class="mermaid">
graph LR
    table[Table `job`]
    lib[SQLAlchemy]
    qmgr[QueueManager]
    pool1(Worker Pool)
    pool2(Worker Pool)
    pool3(Worker Pool)
    table --- lib;
    lib --- qmgr;
    qmgr --- pool1;
    qmgr --- pool2;
    qmgr --- pool3;
</div> <ul><li><code>job</code> is a table in the MySQL database.</li> <li>SQLAlchemy is the SQL library for manipulating job data.</li> <li><code>QueueManager</code> encapsulates the SQLAlchemy and managing logic into threads.</li> <li>Workers run in different threads and consume jobs.</li></ul> <p>Pirlo Server Validation is another Pirlo component for handling server provisioning and repair validation.
Similarly, TOR Starter is the Pirlo component for handling switch provisioning. It validates and configures switches in the racks.
These components inherit the same process of using the SQLAlchemy lib and job table, excepting adding some more fields to their own needs.</p> <div class="mermaid">
graph TB
    lib[SQLAlchemy Library];
    qmgr[QueueManager];
    lib --inherit--&gt; torlib;
    lib --inherit--&gt; serverlib;
    qmgr --inherit--&gt; torqmgr;
    qmgr --inherit--&gt; serverqmgr;
    pool --inherit--&gt; torpool;
    pool --inherit--&gt; serverpool;
    lib --&gt; qmgr;
    qmgr --&gt; pool;
    subgraph tor
        torlib --&gt; torqmgr;
        torqmgr --&gt; torpool;
    end
    subgraph server
        serverlib --&gt; serverqmgr;
        serverqmgr --&gt; serverpool;
    end
</div> <h2 id="on-infrastructure-at-scale-a-cascading-failure-of-distributed-systems"><a href="#on-infrastructure-at-scale-a-cascading-failure-of-distributed-systems" class="header-anchor">#</a> On Infrastructure at Scale: A Cascading Failure of Distributed Systems</h2> <p><a href="https://medium.com/@daniel.p.woods/on-infrastructure-at-scale-a-cascading-failure-of-distributed-systems-7cff2a3cd2df" target="_blank" rel="noopener noreferrer">medium.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Key takeaways are:</p> <ul><li>Smaller clusters, more of them.</li> <li>Shared Docker daemon is a brittle failure point.</li> <li>Having each workload ship with their own logging and metric sidecars is the right thing</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/soasme/enqueuezero/edit/master/techshack.weekly/2019-03.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.26662bcd.js" defer></script><script src="/assets/js/6.d2240214.js" defer></script><script src="/assets/js/147.aa478e29.js" defer></script><script src="/assets/js/3.dd706b41.js" defer></script><script src="/assets/js/4.29da6077.js" defer></script>
  </body>
</html>
